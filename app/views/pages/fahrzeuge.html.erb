<div class="bg-gray-900" data-controller="vehicle-filter" data-vehicle-filter-total-count-value="<%= @total_count %>">
  <%= render "shared/navbar" %>

  <!-- Hero Section with Search -->
  <section class="relative bg-gray-900 pt-8 pb-16">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-4xl font-semibold tracking-tight text-white sm:text-5xl">Unsere Fahrzeuge</h1>
        <p class="mt-4 text-lg text-gray-300">Entdecken Sie unser vielfaltiges Angebot an Qualitatsfahrzeugen.</p>
      </div>

      <!-- Search/Filter Bar -->
      <form action="<%= fahrzeuge_path %>" method="get" data-vehicle-filter-target="form" data-action="change->vehicle-filter#submitForm">
        <div class="bg-gray-800/90 backdrop-blur-sm rounded-xl p-6 shadow-2xl ring-1 ring-white/10">
          <div class="flex items-center gap-4 mb-4">
            <svg class="h-6 w-6 text-sky-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
            </svg>
            <span class="text-white font-semibold">Fahrzeugsuche</span>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
            <div>
              <label for="marke" class="sr-only">Marke</label>
              <select id="marke" name="marke" data-action="change->vehicle-filter#updateModels" class="block w-full rounded-md bg-gray-700 border-0 py-3 px-4 text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Alle Marken</option>
                <% @brands.each do |brand| %>
                  <option value="<%= brand %>" class="bg-gray-900 text-white" <%= 'selected' if params[:marke] == brand %>><%= brand %></option>
                <% end %>
              </select>
            </div>
            <div>
              <label for="modell" class="sr-only">Modell</label>
              <select id="modell" name="modell" class="block w-full rounded-md bg-gray-700 border-0 py-3 px-4 text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Alle Modelle</option>
              </select>
            </div>
            <div>
              <label for="preis" class="sr-only">Preis bis</label>
              <select id="preis" name="preis" class="block w-full rounded-md bg-gray-700 border-0 py-3 px-4 text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Preis bis</option>
                <option value="10000" class="bg-gray-900 text-white" <%= 'selected' if params[:preis] == '10000' %>>10.000 EUR</option>
                <option value="20000" class="bg-gray-900 text-white" <%= 'selected' if params[:preis] == '20000' %>>20.000 EUR</option>
                <option value="30000" class="bg-gray-900 text-white" <%= 'selected' if params[:preis] == '30000' %>>30.000 EUR</option>
                <option value="50000" class="bg-gray-900 text-white" <%= 'selected' if params[:preis] == '50000' %>>50.000 EUR</option>
                <option value="100000" class="bg-gray-900 text-white" <%= 'selected' if params[:preis] == '100000' %>>100.000 EUR</option>
              </select>
            </div>
            <div>
              <label for="erstzulassung" class="sr-only">Erstzulassung ab</label>
              <select id="erstzulassung" name="erstzulassung" class="block w-full rounded-md bg-gray-700 border-0 py-3 px-4 text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Erstzulassung ab</option>
                <% (2017..2024).to_a.reverse.each do |year| %>
                  <option value="<%= year %>" class="bg-gray-900 text-white" <%= 'selected' if params[:erstzulassung] == year.to_s %>><%= year %></option>
                <% end %>
              </select>
            </div>
            <div>
              <button type="submit" class="w-full rounded-md bg-sky-500 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-sky-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-500 transition-colors">
                Suchen
              </button>
            </div>
          </div>
          <!-- Additional Filters Row -->
          <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-4">
            <div>
              <label for="kraftstoff" class="sr-only">Kraftstoff</label>
              <select id="kraftstoff" name="kraftstoff" class="block w-full rounded-md bg-gray-700 border-0 py-2 px-3 text-sm text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Kraftstoff</option>
                <% @fuel_types.each do |fuel| %>
                  <option value="<%= fuel %>" class="bg-gray-900 text-white" <%= 'selected' if params[:kraftstoff] == fuel %>><%= fuel %></option>
                <% end %>
              </select>
            </div>
            <div>
              <label for="getriebe" class="sr-only">Getriebe</label>
              <select id="getriebe" name="getriebe" class="block w-full rounded-md bg-gray-700 border-0 py-2 px-3 text-sm text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Getriebe</option>
                <% @transmissions.each do |trans| %>
                  <option value="<%= trans %>" class="bg-gray-900 text-white" <%= 'selected' if params[:getriebe] == trans %>><%= trans %></option>
                <% end %>
              </select>
            </div>
            <div>
              <label for="km_bis" class="sr-only">Kilometer bis</label>
              <select id="km_bis" name="km_bis" class="block w-full rounded-md bg-gray-700 border-0 py-2 px-3 text-sm text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">km bis</option>
                <option value="25000" class="bg-gray-900 text-white" <%= 'selected' if params[:km_bis] == '25000' %>>25.000 km</option>
                <option value="50000" class="bg-gray-900 text-white" <%= 'selected' if params[:km_bis] == '50000' %>>50.000 km</option>
                <option value="100000" class="bg-gray-900 text-white" <%= 'selected' if params[:km_bis] == '100000' %>>100.000 km</option>
                <option value="150000" class="bg-gray-900 text-white" <%= 'selected' if params[:km_bis] == '150000' %>>150.000 km</option>
              </select>
            </div>
            <div>
              <label for="leistung" class="sr-only">Leistung ab</label>
              <select id="leistung" name="leistung" class="block w-full rounded-md bg-gray-700 border-0 py-2 px-3 text-sm text-white ring-1 ring-inset ring-gray-600 focus:ring-2 focus:ring-sky-500">
                <option value="" class="bg-gray-900 text-white">Leistung ab</option>
                <option value="75" class="bg-gray-900 text-white" <%= 'selected' if params[:leistung] == '75' %>>75 PS</option>
                <option value="100" class="bg-gray-900 text-white" <%= 'selected' if params[:leistung] == '100' %>>100 PS</option>
                <option value="150" class="bg-gray-900 text-white" <%= 'selected' if params[:leistung] == '150' %>>150 PS</option>
                <option value="200" class="bg-gray-900 text-white" <%= 'selected' if params[:leistung] == '200' %>>200 PS</option>
                <option value="300" class="bg-gray-900 text-white" <%= 'selected' if params[:leistung] == '300' %>>300 PS</option>
              </select>
            </div>
            <div class="col-span-2 sm:col-span-4 lg:col-span-4 flex items-center justify-end">
              <a href="<%= fahrzeuge_path %>" class="text-sm text-sky-400 hover:text-sky-300 font-medium">
                Filter zurucksetzen
              </a>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>

  <!-- Results Section -->
  <section class="bg-white py-16">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <!-- Results Header -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 gap-4">
        <div>
          <p class="text-gray-600"><span class="font-semibold text-gray-900"><%= @vehicles.count %></span> Fahrzeuge gefunden</p>
        </div>
        <div class="flex items-center gap-4">
          <label for="sort" class="text-sm text-gray-600">Sortieren nach:</label>
          <select id="sort" name="sort" data-action="change->vehicle-filter#sort" class="rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-sky-500 focus:ring-sky-500">
            <option value="newest" <%= 'selected' if params[:sort].blank? || params[:sort] == 'newest' %>>Neueste zuerst</option>
            <option value="price-asc" <%= 'selected' if params[:sort] == 'price-asc' %>>Preis aufsteigend</option>
            <option value="price-desc" <%= 'selected' if params[:sort] == 'price-desc' %>>Preis absteigend</option>
            <option value="km-asc" <%= 'selected' if params[:sort] == 'km-asc' %>>Kilometer aufsteigend</option>
            <option value="year-desc" <%= 'selected' if params[:sort] == 'year-desc' %>>Erstzulassung neueste</option>
          </select>
        </div>
      </div>

      <% if @vehicles.empty? %>
        <!-- No Results Message -->
        <div class="text-center py-16">
          <svg class="mx-auto h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
          </svg>
          <h3 class="mt-4 text-lg font-semibold text-gray-900">Keine Fahrzeuge gefunden</h3>
          <p class="mt-2 text-gray-500">Versuchen Sie, Ihre Filterkriterien anzupassen.</p>
          <a href="<%= fahrzeuge_path %>" class="mt-6 inline-flex items-center rounded-md bg-sky-500 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-400">
            Filter zurucksetzen
          </a>
        </div>
      <% else %>
        <!-- Car Cards Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <% @vehicles.each do |vehicle| %>
            <%= render "pages/vehicle_card", vehicle: vehicle %>
          <% end %>
        </div>
      <% end %>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-gray-900 py-16">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div class="mx-auto max-w-2xl text-center">
        <h2 class="text-3xl font-semibold tracking-tight text-white sm:text-4xl">Nicht das passende Fahrzeug gefunden?</h2>
        <p class="mt-4 text-lg text-gray-300">Kontaktieren Sie uns - wir helfen Ihnen gerne bei der Suche nach Ihrem Traumauto.</p>
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/#kontakt" class="rounded-md bg-sky-500 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-sky-400 transition-colors">Kontakt aufnehmen</a>
          <a href="tel:+491234567890" class="rounded-md bg-white/10 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-white/20 transition-colors">+49 (0) 123 456 789</a>
        </div>
      </div>
    </div>
  </section>

  <%= render "shared/footer" %>
</div>
